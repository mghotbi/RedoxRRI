% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RRI_pipeline_st.R
\name{rri_pipeline_st}
\alias{rri_pipeline_st}
\title{Holobiont Redox Resilience Index (RRI) with spatio-temporal dynamics}
\usage{
rri_pipeline_st(
  ROS_flux,
  Eh_stability,
  micro_data = NULL,
  graph = NULL,
  id = NULL,
  time_col = NULL,
  group_cols = NULL,
  mode = c("snapshot", "rolling", "event"),
  window = 3,
  align = c("right", "center", "left"),
  event_col = NULL,
  baseline_label = "pre",
  recovery_labels = "recovery",
  alpha_micro = 0.5,
  method_phys = "pca",
  method_soil = "pca",
  method_micro = "pca",
  direction_phys = c("auto", "higher_is_better", "lower_is_better"),
  direction_soil = c("auto", "higher_is_better", "lower_is_better"),
  direction_micro = c("auto", "higher_is_better", "lower_is_better"),
  direction_anchor_phys = NULL,
  direction_anchor_soil = NULL,
  direction_anchor_micro = NULL,
  scale_by = NULL,
  network_agg = c("equation", "mean"),
  w1 = 0.4,
  w2 = 0.35,
  w3 = 0.25,
  add_coupling = FALSE,
  coupling_weight = 0,
  coupling_fun = c("geometric_mean", "agreement"),
  norm_method = NULL
)
}
\arguments{
\item{ROS_flux}{Data frame or matrix; samples in rows, physiological traits in columns.}

\item{Eh_stability}{Data frame or matrix; samples in rows, soil redox variables in columns.}

\item{micro_data}{Optional data frame or matrix; samples in rows, microbial features in columns.}

\item{graph}{Optional microbial network input: either a single \pkg{igraph} object (system-level)
or a list of \pkg{igraph} objects (one per sample).}

\item{id}{Optional data frame describing sample identities. If provided, must have
\code{nrow(id) == nrow(ROS_flux)}. Typical columns: \code{plot}, \code{depth}, \code{plant_id}, \code{time}.}

\item{time_col}{Character. Name of time column in \code{id}. Required for \code{mode != "snapshot"}.}

\item{group_cols}{Character vector. Columns in \code{id} defining spatial/experimental units.}

\item{mode}{One of \code{"snapshot"}, \code{"rolling"}, \code{"event"}.}

\item{window}{Integer >= 2. Rolling window size for \code{mode = "rolling"}.}

\item{align}{Character. Rolling alignment: \code{"right"}, \code{"center"}, \code{"left"}.}

\item{event_col}{Character. Column in \code{id} containing event labels (for \code{mode = "event"}).}

\item{baseline_label}{Character. Label defining baseline period.}

\item{recovery_labels}{Character vector defining recovery periods.}

\item{alpha_micro}{Numeric in \eqn{[0,1]}. Blend weight:
\deqn{\mathrm{Micro} = \alpha \cdot \mathrm{abundance} + (1-\alpha) \cdot \mathrm{network}.}}

\item{method_phys, method_soil, method_micro}{Latent extraction methods:
\code{"pca"}, \code{"scale"}, \code{"mean"}, \code{"fa"}, \code{"umap"}, \code{"nmf"}, \code{"wgcna"}.}

\item{direction_phys, direction_soil, direction_micro}{Direction semantics:
\code{"higher_is_better"}, \code{"lower_is_better"}, \code{"auto"}.}

\item{direction_anchor_phys, direction_anchor_soil, direction_anchor_micro}{Optional anchor column names used when corresponding direction is \code{"auto"}.}

\item{scale_by}{Character vector of columns in \code{id} within which to scale domain scores to \eqn{[0,1]}.
Defaults to \code{group_cols}. Set \code{NULL} for global scaling.}

\item{network_agg}{Aggregation for network metrics: \code{"equation"} or \code{"mean"}.}

\item{w1, w2, w3}{Nonnegative domain weights that must sum to 1.}

\item{add_coupling}{Logical. If TRUE, adds a coupling/coherence term among domains.}

\item{coupling_weight}{Numeric in \eqn{[0,1]}. Weight for coupling term; domain weights are renormalized
to sum to \eqn{1 - \mathrm{coupling\_weight}}.}

\item{coupling_fun}{Coupling function: \code{"geometric_mean"} or \code{"agreement"}.}

\item{norm_method}{Optional legacy override; if supplied, overrides \code{method_*}.}
}
\value{
An object of class \code{"RRI"} (a named list) with:
\describe{
\item{row_scores}{Absolute domain scores and \code{RRI} (all scaled to \eqn{[0,1]}).}
\item{row_scores_comp}{Compositional domain contributions and \code{RRI} (Physio + Soil + Micro = 1 when defined).}
\item{dyn_scores}{Dynamic summaries for rolling/event modes; \code{NULL} for snapshot mode.}
\item{meta}{Settings and system-level mean RRI (\code{rri_index}).}
}
}
\description{
This function constructs a holobiont-scale resilience index from three domains:
\enumerate{
\item \strong{Physiology} (plant oxidative buffering and stress-response traits)
\item \strong{Soil} (redox chemistry and stability proxies)
\item \strong{Microbial} resilience, optionally \strong{blended} from:
\itemize{
\item microbial abundance or functional features (\code{micro_data})
\item microbial network organization (\code{graph})
}
}
}
\details{
Computes a holobiont-level Redox Resilience Index (RRI) by integrating
plant physiology, soil redox chemistry, and microbial resilience into a unified,
directionally identifiable index with explicit support for spatial and temporal designs.
\subsection{Returned domain representations}{

The output includes both:
\itemize{
\item \strong{Absolute domain scores} (\code{Physio}, \code{Soil}, \code{Micro}) scaled to \eqn{[0,1]}.
\item \strong{Compositional domain contributions} (\code{Physio}, \code{Soil}, \code{Micro})
projected to sum to 1 (ternary-ready).
}
}

\subsection{Direction identifiability}{

Latent methods (e.g., PCA/FA) have arbitrary sign. When \code{direction_* = "auto"},
the latent score is flipped (if needed) so that higher latent values align with higher
values of the specified anchor variable.
}

\subsection{Missing data handling}{

Robust median imputation is applied \emph{within strata} (defined by \code{scale_by})
before latent extraction. This avoids failures in SVD-based methods and reduces bias
under MNAR sensor dropout and redox shocks.
}

\subsection{Spatio-temporal modes}{

\describe{
\item{\code{"snapshot"}}{Independent per-sample RRI (default).}
\item{\code{"rolling"}}{Rolling-window dynamic RRI within \code{group_cols} ordered by \code{time_col}.}
\item{\code{"event"}}{Baseline–pulse–recovery summaries by group using \code{event_col}.}
}
}
}
\examples{
sim <- simulate_redox_holobiont(seed = 1)

res <- rri_pipeline_st(
  ROS_flux = sim$ROS_flux,
  Eh_stability = sim$Eh_stability,
  micro_data = sim$micro_data,
  id = sim$id,
  group_cols = c("plot", "depth"),
  scale_by = c("plot", "depth"),
  direction_phys = "auto",
  direction_anchor_phys = "FvFm",
  direction_soil = "auto",
  direction_anchor_soil = "Eh",
  direction_micro = "higher_is_better"
)

head(res$row_scores)
head(res$row_scores_comp)

}
