% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RRI_pipeline.R
\name{RRI_pipeline}
\alias{RRI_pipeline}
\title{Redox Resilience Index (RRI) with Microbial Abundance + Network Blending}
\usage{
RRI_pipeline(
  ROS_flux,
  Eh_stability,
  micro_data = NULL,
  graph = NULL,
  alpha_micro = 0.5,
  method_phys = "pca",
  method_soil = "pca",
  method_micro = "pca",
  network_agg = c("equation", "mean"),
  w1 = 0.4,
  w2 = 0.35,
  w3 = 0.25,
  norm_method = NULL
)
}
\arguments{
\item{ROS_flux}{Data frame/matrix; samples in rows, physiological/ROS traits in columns.}

\item{Eh_stability}{Data frame/matrix; samples in rows, soil redox chemistry variables in columns.}

\item{micro_data}{Optional data frame/matrix; samples in rows, microbial features in columns
(e.g., ASV/OTU abundances, MAG/pathway abundances, functional genes).}

\item{graph}{Optional microbial network input. Either a single \pkg{igraph} object (system-level network)
or a list of \pkg{igraph} objects (one per sample).}

\item{alpha_micro}{Numeric in \eqn{[0,1]}. Weight for microbial abundance contribution in the blended
microbial score \eqn{\mathrm{Micro}^{\ast}}. Default \code{0.5}.}

\item{method_phys, method_soil, method_micro}{Latent extraction methods per domain. One of:
\code{"pca"}, \code{"scale"}, \code{"mean"}, \code{"fa"}, \code{"umap"}, \code{"nmf"}, \code{"wgcna"}.}

\item{network_agg}{Character; one of \code{"equation"} (sqrt composite with \eqn{1-H}) or
\code{"mean"} (mean of normalized network metrics).}

\item{w1, w2, w3}{Numeric weights (>=0) that must sum to 1.}

\item{norm_method}{Optional legacy argument: if supplied, it overrides
\code{method_phys}, \code{method_soil}, and \code{method_micro}.}
}
\value{
A data frame with columns:
\describe{
\item{Physio}{Compositional physiological component (0–1).}
\item{Soil}{Compositional soil component (0–1).}
\item{Micro}{Compositional blended microbial component (0–1).}
\item{RRI}{Per-sample Redox Resilience Index (0–1).}
\item{RRI_index}{System-level mean RRI across samples.}
\item{Micro_abundance}{Unblended microbial abundance latent score (0–1), if \code{micro_data} provided.}
\item{Micro_network}{Unblended microbial network score (0–1), if \code{graph} provided.}
}
The mean RRI is also stored as \code{attr(df, "RRI_index")}.
}
\description{
Computes a holobiont-level \strong{Redox Resilience Index (RRI)} as a weighted,
normalized composite of three domains:
\enumerate{
\item \strong{Physiology} (oxidative–nitrosative buffering; \code{ROS_flux})
\item \strong{Soil} (redox stability; \code{Eh_stability})
\item \strong{Microbial resilience} (\strong{blended} from abundance/functional structure and network organization)
}

The pipeline is designed for \strong{index construction + hypothesis testing}:
it converts multivariate domain measurements into \strong{1D latent scores} (0–1),
applies domain-specific transforms consistent with the RRI conceptual equation,
then combines them with interpretable weights \eqn{w_1,w_2,w_3}.
}
\details{
Holobiont Redox Resilience Index (RRI) Pipeline (Physiology + Soil + Microbial Blended Domain)
\subsection{Conceptual equation (domain-level)}{

The default RRI combines normalized domain scores using:
\deqn{
\mathrm{RRI}
= w_1\exp(-\mathrm{ROS}^{\ast})
+ w_2(\mathrm{Eh}^{\ast})^2
+ w_3\mathrm{Micro}^{\ast}
}
where \eqn{(\ast)} indicates normalization to \eqn{[0,1]} and \eqn{w_1+w_2+w_3=1}.
\subsection{Microbial domain as a blended latent score (Option A)}{

Microbial resilience is represented as a \strong{single} domain score to preserve a
\strong{3-domain ternary} (Physio/Soil/Micro) while allowing two complementary microbial aspects:

\deqn{
\mathrm{Micro}^{\ast}
= \alpha\,\mathrm{Micro}^{\ast}_{\mathrm{abund}}
+ (1-\alpha)\,\mathrm{Micro}^{\ast}_{\mathrm{net}}
}
\itemize{
\item \eqn{\mathrm{Micro}^{\ast}_{\mathrm{abund}}} is a latent score from \code{micro_data}
(e.g., ASV/OTU abundances, MAG/pathways, functional genes).
\item \eqn{\mathrm{Micro}^{\ast}_{\mathrm{net}}} is a latent score from \code{graph}
(network organization metrics).
\item \eqn{\alpha \in [0,1]} is controlled by \code{alpha_micro}:
\itemize{
\item \code{alpha_micro = 1} uses abundance/functional only
\item \code{alpha_micro = 0} uses network only
\item intermediate values blend both (default \code{0.5})
}
}

This blending is \strong{within} the microbial domain, then the microbial domain is
weighted by \eqn{w_3} within the full RRI.
}

}

\subsection{Latent-dimension methods (recommended usage table)}{

Each domain can be summarized by a \strong{1D latent score} using different methods:

\tabular{lll}{
\strong{Method} \tab \strong{Assumption / Strength} \tab \strong{Recommended when} \cr
\code{"mean"} \tab Equal contribution \tab Small \eqn{p}, baseline index \cr
\code{"scale"} \tab Standardize then average \tab Mixed units; robust baseline \cr
\code{"pca"} \tab Dominant linear axis \tab Moderate–strong covariance; interpretable gradient \cr
\code{"fa"} \tab Latent factor + noise \tab Measurement error; denoising desired \cr
\code{"umap"} \tab Nonlinear manifold \tab Regime shifts / thresholds / nonlinear stress responses \cr
\code{"nmf"} \tab Additive nonnegative structure \tab Abundances/fluxes; parts-based factors \cr
\code{"wgcna"} \tab Co-regulated modules \tab Soil/micro syndromes; larger \eqn{p}; correlated variables \cr
}
\subsection{Domain-specific accuracy notes (important)}{

\itemize{
\item \strong{Soil redox chemistry:} \code{"wgcna"} is often appropriate because Eh/Fe/Mn/N
variables are frequently co-regulated by shared redox processes.
\item \strong{Physiology/ROS traits:} \code{"wgcna"} is appropriate only when traits reflect a
coordinated stress-response syndrome; otherwise \code{"pca"} or \code{"fa"} is usually preferred.
\item \strong{Microbial abundance:} \code{"pca"}, \code{"nmf"}, \code{"wgcna"} are common choices;
\code{"nmf"} is useful for nonnegative counts/abundances.
}
}

}

\subsection{Network metrics used for \eqn{\mathrm{Micro}^{\ast}_{\mathrm{net}}}}{

If \code{graph} is provided, we compute:
\itemize{
\item \eqn{Q}: Louvain modularity
\item \eqn{C}: mean local clustering coefficient
\item \eqn{E}: global efficiency proxy \eqn{1/\overline{d}} (inverse mean shortest path length)
\item \eqn{H}: degree centralization (heterogeneity proxy)
}
These are normalized to \eqn{[0,1]} and aggregated as:
\deqn{
\mathrm{Micro}^{\ast}_{\mathrm{net}}
= \sqrt{\tfrac{1}{4}\left(Q^{\ast}+C^{\ast}+E^{\ast}+(1-H^{\ast})\right)}
}
(or \code{network_agg = "mean"} for a simpler arithmetic mean).
}

\subsection{Robustness and edge cases}{

\itemize{
\item All per-sample outputs are scaled to \eqn{[0,1]}.
\item If \code{graph} is a single \pkg{igraph} object, \eqn{\mathrm{Micro}^{\ast}_{\mathrm{net}}}
is treated as \strong{system-level} and replicated across samples.
\item If \code{graph} is a list of graphs, it must have length \code{nrow(ROS_flux)}
and yields sample-specific network scores.
\item For \code{method = "wgcna"}: if WGCNA yields only a grey module or eigengenes cannot be computed,
the method \strong{falls back to PCA} (no hard failure).
\item For \code{method = "nmf"}: data are shifted to be nonnegative if needed.
}
}
}
\section{Package dependency guidance}{

\itemize{
\item \strong{Imports:} \pkg{stats}, \pkg{igraph}
\item \strong{Suggests:} \pkg{WGCNA}, \pkg{psych}, \pkg{uwot}, \pkg{NMF}
}
Optional methods are activated only when those packages are installed.
}

\examples{
# ---- Physiology + soil + microbial abundance + network ------------------
set.seed(1)
ROS_flux <- data.frame(
  SPAD    = rnorm(30, 35, 3),
  FvFm    = rnorm(30, 0.78, 0.03),
  PhiPSII = rnorm(30, 0.40, 0.05),
  NPQ     = rnorm(30, 1.2, 0.2)
)

Eh_stability <- data.frame(
  Eh       = runif(30, 0.3, 0.9),
  Fe2.Fe3  = rbeta(30, 3, 5),
  Mn2.Mn4  = rbeta(30, 2, 6),
  NH4.NO3  = rnorm(30, 1.5, 0.4)
)

# microbial abundance/features (e.g., ASVs)
micro_data <- matrix(rexp(30 * 50, rate = 2), nrow = 30)
colnames(micro_data) <- paste0("ASV", seq_len(ncol(micro_data)))

# microbial network (system-level)
if (requireNamespace("igraph", quietly = TRUE)) {
  g <- igraph::sample_smallworld(1, 40, 5, 0.10)
  g <- igraph::simplify(g)

  out <- RRI_pipeline(
    ROS_flux,
    Eh_stability,
    micro_data   = micro_data,
    graph        = g,
    alpha_micro  = 0.6,         # 60\% abundance, 40\% network
    method_phys  = "pca",
    method_soil  = "wgcna",
    method_micro = "pca",
    network_agg  = "equation",
    w1 = 0.4, w2 = 0.35, w3 = 0.25
  )
  head(out)
  attr(out, "RRI_index")
}

}
